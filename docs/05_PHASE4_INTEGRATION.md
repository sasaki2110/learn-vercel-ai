# ãƒ•ã‚§ãƒ¼ã‚º4: å®Ÿè·µç·¨ - çµ±åˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€ã“ã‚Œã¾ã§ã«å­¦ç¿’ã—ãŸå†…å®¹ã‚’çµ±åˆã—ã¦å®Ÿç”¨çš„ãªAIã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ§‹ç¯‰ã™ã‚‹ãŸã‚ã®è©³ç´°ã‚¬ã‚¤ãƒ‰ã§ã™ã€‚ãƒ•ã‚§ãƒ¼ã‚º1ã€œ3ã§å­¦ã‚“ã çŸ¥è­˜ã‚’æ´»ç”¨ã—ã€ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã‚’é©ç”¨ã—ãªãŒã‚‰æœ¬æ ¼çš„ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚

---

## ğŸ“‹ ç›®æ¬¡

1. [ãƒ•ã‚§ãƒ¼ã‚º4ã®æ¦‚è¦](#1-ãƒ•ã‚§ãƒ¼ã‚º4ã®æ¦‚è¦)
2. [ã“ã‚Œã¾ã§ã®å­¦ç¿’å†…å®¹ã®å¾©ç¿’](#2-ã“ã‚Œã¾ã§ã®å­¦ç¿’å†…å®¹ã®å¾©ç¿’)
3. [ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ1: é«˜åº¦ãªãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆ](#3-ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ1-é«˜åº¦ãªãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆ)
4. [ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ2: AIæ”¯æ´ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç”Ÿæˆãƒ„ãƒ¼ãƒ«](#4-ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ2-aiæ”¯æ´ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç”Ÿæˆãƒ„ãƒ¼ãƒ«)
5. [ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ3: ãƒãƒ«ãƒãƒ¢ãƒ¼ãƒ€ãƒ«AIã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³](#5-ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ3-ãƒãƒ«ãƒãƒ¢ãƒ¼ãƒ€ãƒ«aiã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³)
6. [ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹](#6-ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹)
7. [ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ã¨ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](#7-ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ã¨ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)
8. [å®Ÿè·µã‚¿ã‚¹ã‚¯](#8-å®Ÿè·µã‚¿ã‚¹ã‚¯)
9. [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#9-ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)

---

## 1. ãƒ•ã‚§ãƒ¼ã‚º4ã®æ¦‚è¦

### 1.1 ç›®æ¨™

ãƒ•ã‚§ãƒ¼ã‚º4ã§ã¯ã€ä»¥ä¸‹ã®ç›®æ¨™ã‚’é”æˆã—ã¾ã™ï¼š

- **çµ±åˆ**: ãƒ•ã‚§ãƒ¼ã‚º1ã€œ3ã§å­¦ç¿’ã—ãŸå†…å®¹ã‚’çµ±åˆã™ã‚‹
- **å®Ÿè·µ**: å®Ÿç”¨çš„ãªAIã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ§‹ç¯‰ã™ã‚‹
- **ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹**: ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³å“è³ªã®ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã
- **æ‹¡å¼µæ€§**: å°†æ¥ã®æ‹¡å¼µã‚’è€ƒæ…®ã—ãŸè¨­è¨ˆ

### 1.2 å‰ææ¡ä»¶

ãƒ•ã‚§ãƒ¼ã‚º4ã‚’é–‹å§‹ã™ã‚‹å‰ã«ã€ä»¥ä¸‹ã‚’å®Œäº†ã—ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š

- [ ] ãƒ•ã‚§ãƒ¼ã‚º1: AI SDKã®åŸºç¤ã‚’ç†è§£ã—ã¦ã„ã‚‹
- [ ] ãƒ•ã‚§ãƒ¼ã‚º2: AI Elementsã‚’ä½¿ç”¨ã§ãã‚‹
- [ ] ãƒ•ã‚§ãƒ¼ã‚º3: Streamdownã‚’å®Ÿè£…ã§ãã‚‹
- [ ] åŸºæœ¬çš„ãªNext.jsã®çŸ¥è­˜ãŒã‚ã‚‹
- [ ] TypeScriptã®åŸºç¤ã‚’ç†è§£ã—ã¦ã„ã‚‹

### 1.3 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®é¸æŠ

ä»¥ä¸‹ã®3ã¤ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰é¸æŠã§ãã¾ã™ï¼š

1. **é«˜åº¦ãªãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆ**: æœ€ã‚‚åŒ…æ‹¬çš„ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ
2. **AIæ”¯æ´ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç”Ÿæˆãƒ„ãƒ¼ãƒ«**: å®Ÿç”¨çš„ãªãƒ„ãƒ¼ãƒ«
3. **ãƒãƒ«ãƒãƒ¢ãƒ¼ãƒ€ãƒ«AIã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³**: é«˜åº¦ãªæ©Ÿèƒ½ã‚’å­¦ã¶

**æ¨å¥¨**: ã¾ãšã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ1ã‹ã‚‰å§‹ã‚ã€ãã®å¾Œãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ2ã€3ã«é€²ã‚€ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚

---

## 2. ã“ã‚Œã¾ã§ã®å­¦ç¿’å†…å®¹ã®å¾©ç¿’

### 2.1 ãƒ•ã‚§ãƒ¼ã‚º1: AI SDK Core

**ä¸»è¦ãªæ¦‚å¿µ:**
- `generateText`: ãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆ
- `streamText`: ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆ
- `generateObject`: æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
- ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã¨ãƒ¢ãƒ‡ãƒ«ã®é¸æŠ
- API Route Handlerã®ä½œæˆ

**é‡è¦ãªãƒã‚¤ãƒ³ãƒˆ:**
```typescript
// API Route Handlerã®åŸºæœ¬æ§‹é€ ï¼ˆAI SDK 6å¯¾å¿œï¼‰
import { convertToModelMessages, streamText, UIMessage } from 'ai';
import { openai } from '@ai-sdk/openai';

export async function POST(req: Request) {
  const { messages }: { messages: UIMessage[] } = await req.json();
  const result = await streamText({
    model: openai('gpt-4'),
    messages: await convertToModelMessages(messages),  // AI SDK 6ã§ã¯UIMessageã‚’ModelMessageã«å¤‰æ›
  });
  return result.toUIMessageStreamResponse();  // AI SDK 6ã§ã¯useChat()ãŒã“ã®å½¢å¼ã‚’æœŸå¾…
}
```

### 2.2 ãƒ•ã‚§ãƒ¼ã‚º2: AI Elements

**ä¸»è¦ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ:**
- `Message`: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
- `Conversation`: ä¼šè©±ã‚³ãƒ³ãƒ†ãƒŠ
- `Input`: å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰

**é‡è¦ãªãƒã‚¤ãƒ³ãƒˆ:**
```typescript
import { Message, MessageContent, MessageResponse } from '@/components/ai-elements/message';
import { useChat } from '@ai-sdk/react';

const { messages } = useChat({ api: '/api/chat' });
```

### 2.3 ãƒ•ã‚§ãƒ¼ã‚º3: Streamdown

**ä¸»è¦ãªæ©Ÿèƒ½:**
- æœªçµ‚äº†Markdownãƒ–ãƒ­ãƒƒã‚¯ã®ã‚µãƒãƒ¼ãƒˆ
- ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆ
- Mermaidå›³ã®è¡¨ç¤º
- æ•°å¼è¡¨ç¾

**é‡è¦ãªãƒã‚¤ãƒ³ãƒˆ:**
```typescript
import { Streamdown } from 'streamdown';

<Streamdown isAnimating={isLoading}>
  {message.content}
</Streamdown>
```

---

## 3. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ1: é«˜åº¦ãªãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆ

### 3.1 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

é«˜åº¦ãªãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã¯ã€ä»¥ä¸‹ã‚’å«ã‚€åŒ…æ‹¬çš„ãªAIã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ï¼š

- AI SDK Coreã‚’ä½¿ç”¨ã—ãŸãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…
- AI Elementsã‚’ä½¿ç”¨ã—ãŸãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…
- Streamdownã‚’ä½¿ç”¨ã—ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
- ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—ã®å®Ÿè£…
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æ°¸ç¶šåŒ–
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### 3.2 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
app/
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ chat/
â”‚   â”‚   â””â”€â”€ route.ts          # ãƒãƒ£ãƒƒãƒˆAPI
â”‚   â””â”€â”€ tools/
â”‚       â””â”€â”€ route.ts          # ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—API
â”œâ”€â”€ chat/
â”‚   â””â”€â”€ page.tsx              # ãƒãƒ£ãƒƒãƒˆãƒšãƒ¼ã‚¸
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ chat/
â”‚   â”‚   â”œâ”€â”€ ChatInterface.tsx
â”‚   â”‚   â”œâ”€â”€ MessageList.tsx
â”‚   â”‚   â””â”€â”€ ChatInput.tsx
â”‚   â””â”€â”€ ui/                   # shadcn/uiã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ db.ts                 # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶š
â”‚   â””â”€â”€ utils.ts
â””â”€â”€ types/
    â””â”€â”€ chat.ts               # TypeScriptå‹å®šç¾©
```

### 3.3 å®Ÿè£…æ‰‹é †

#### ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
# å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm i ai @ai-sdk/react streamdown
npm i -D @types/node
```

#### ã‚¹ãƒ†ãƒƒãƒ—2: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æ°¸ç¶šåŒ–ã«ã¯ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒå¿…è¦ã§ã™ã€‚ä¾‹ã¨ã—ã¦ã€SQLiteã‚’ä½¿ç”¨ï¼š

```bash
npm i better-sqlite3
npm i -D @types/better-sqlite3
```

**`lib/db.ts`**ã‚’ä½œæˆï¼š

```typescript
import Database from 'better-sqlite3';

const db = new Database('chat.db');

// ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä½œæˆ
db.exec(`
  CREATE TABLE IF NOT EXISTS messages (
    id TEXT PRIMARY KEY,
    role TEXT NOT NULL,
    content TEXT NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
  )
`);

export { db };
```

#### ã‚¹ãƒ†ãƒƒãƒ—3: API Route Handlerã®ä½œæˆ

**`app/api/chat/route.ts`**ã‚’ä½œæˆï¼š

```typescript
import { convertToModelMessages, streamText, UIMessage } from 'ai';
import { openai } from '@ai-sdk/openai';
import { db } from '@/lib/db';

export async function POST(req: Request) {
  try {
    const { messages, conversationId }: { messages: UIMessage[]; conversationId?: string } = await req.json();

    // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
    if (conversationId) {
      messages.forEach((msg: UIMessage) => {
        db.prepare(
          'INSERT OR REPLACE INTO messages (id, role, content) VALUES (?, ?, ?)'
        ).run(`${conversationId}-${msg.id}`, msg.role, msg.content);
      });
    }

    const result = await streamText({
      model: openai('gpt-4'),
      messages: await convertToModelMessages(messages),  // AI SDK 6ã§ã¯UIMessageã‚’ModelMessageã«å¤‰æ›
      maxTokens: 1000,
      temperature: 0.7,
    });

    return result.toUIMessageStreamResponse();  // AI SDK 6ã§ã¯useChat()ãŒã“ã®å½¢å¼ã‚’æœŸå¾…
  } catch (error) {
    console.error('Chat API error:', error);
    return Response.json(
      { error: 'Failed to process chat request' },
      { status: 500 }
    );
  }
}
```

#### ã‚¹ãƒ†ãƒƒãƒ—4: ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—ã®å®Ÿè£…

**`app/api/chat/route.ts`**ã«ãƒ„ãƒ¼ãƒ«ã‚’è¿½åŠ ï¼š

```typescript
import { z } from 'zod';

const tools = {
  getWeather: {
    description: 'Get the current weather for a location',
    parameters: z.object({
      location: z.string().describe('The city and state, e.g. San Francisco, CA'),
    }),
    execute: async ({ location }: { location: string }) => {
      // å®Ÿéš›ã®å¤©æ°—APIã‚’å‘¼ã³å‡ºã™
      // ã“ã“ã§ã¯ä¾‹ã¨ã—ã¦å›ºå®šå€¤ã‚’è¿”ã™
      return {
        location,
        temperature: '72Â°F',
        condition: 'Sunny',
      };
    },
  },
  calculate: {
    description: 'Perform a mathematical calculation',
    parameters: z.object({
      expression: z.string().describe('Mathematical expression to evaluate'),
    }),
    execute: async ({ expression }: { expression: string }) => {
      try {
        // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ãŸã‚ã€evalã¯ä½¿ç”¨ã—ãªã„
        // å®Ÿéš›ã®å®Ÿè£…ã§ã¯ã€å®‰å…¨ãªè¨ˆç®—ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨
        return { result: 'Calculation result' };
      } catch (error) {
        return { error: 'Invalid expression' };
      }
    },
  },
};

export async function POST(req: Request) {
  const { messages }: { messages: UIMessage[] } = await req.json();

  const result = await streamText({
    model: openai('gpt-4'),
    messages: await convertToModelMessages(messages),  // AI SDK 6ã§ã¯UIMessageã‚’ModelMessageã«å¤‰æ›
    tools,
  });

  return result.toUIMessageStreamResponse();  // AI SDK 6ã§ã¯useChat()ãŒã“ã®å½¢å¼ã‚’æœŸå¾…
}
```

#### ã‚¹ãƒ†ãƒƒãƒ—5: ãƒãƒ£ãƒƒãƒˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®ä½œæˆ

**`app/chat/page.tsx`**ã‚’ä½œæˆï¼š

```typescript
'use client';

import { Conversation } from '@/components/ai-elements/conversation';
import {
  Message,
  MessageContent,
  MessageResponse,
} from '@/components/ai-elements/message';
import { Input } from '@/components/ai-elements/input';
import { Streamdown } from 'streamdown';
import { useChat } from '@ai-sdk/react';
import { useState, useEffect } from 'react';

export default function ChatPage() {
  const [conversationId] = useState(() => `conv-${Date.now()}`);
  const { messages, input, handleInputChange, handleSubmit, isLoading, error } =
    useChat({
      api: '/api/chat',
      body: {
        conversationId,
      },
      onError: (error) => {
        console.error('Chat error:', error);
      },
    });

  // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æ°¸ç¶šåŒ–ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼‰
  useEffect(() => {
    if (messages.length > 0) {
      localStorage.setItem(
        `chat-${conversationId}`,
        JSON.stringify(messages)
      );
    }
  }, [messages, conversationId]);

  // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å¾©å…ƒ
  useEffect(() => {
    const saved = localStorage.getItem(`chat-${conversationId}`);
    if (saved) {
      try {
        const parsed = JSON.parse(saved);
        // useChatã®setMessagesã‚’ä½¿ç”¨ã—ã¦å¾©å…ƒ
      } catch (error) {
        console.error('Failed to restore messages:', error);
      }
    }
  }, [conversationId]);

  return (
    <div className="flex flex-col h-screen bg-gray-50 dark:bg-gray-900">
      {/* Header */}
      <header className="border-b bg-white dark:bg-gray-800 p-4">
        <h1 className="text-xl font-semibold">Advanced Chat Bot</h1>
      </header>

      {/* Messages */}
      <Conversation className="flex-1 overflow-y-auto p-4 space-y-4">
        {messages.length === 0 && (
          <div className="text-center text-gray-500 mt-8">
            <p>Start a conversation by typing a message below.</p>
            <p className="text-sm mt-2">
              Try asking about the weather or requesting a calculation!
            </p>
          </div>
        )}
        {messages.map((message) => (
          <Message
            key={message.id}
            from={message.role}
            className="max-w-3xl mx-auto"
          >
            <MessageContent>
              <MessageResponse>
                {message.role === 'assistant' ? (
                  <Streamdown isAnimating={isLoading}>
                    {message.content}
                  </Streamdown>
                ) : (
                  message.content
                )}
              </MessageResponse>
              {message.toolInvocations && message.toolInvocations.length > 0 && (
                <div className="mt-2 space-y-2">
                  {message.toolInvocations.map((tool, index) => (
                    <div
                      key={index}
                      className="p-2 bg-gray-100 dark:bg-gray-700 rounded text-sm"
                    >
                      <p className="font-semibold">Tool: {tool.toolName}</p>
                      <pre className="text-xs mt-1">
                        {JSON.stringify(tool.args, null, 2)}
                      </pre>
                      {tool.result && (
                        <p className="mt-1">Result: {JSON.stringify(tool.result)}</p>
                      )}
                    </div>
                  ))}
                </div>
              )}
            </MessageContent>
          </Message>
        ))}
        {isLoading && (
          <Message from="assistant" className="max-w-3xl mx-auto">
            <MessageContent>
              <MessageResponse>
                <span className="animate-pulse">Thinking...</span>
              </MessageResponse>
            </MessageContent>
          </Message>
        )}
        {error && (
          <div className="max-w-3xl mx-auto p-4 bg-red-100 dark:bg-red-900 rounded">
            <p className="text-red-800 dark:text-red-200">
              Error: {error.message}
            </p>
          </div>
        )}
      </Conversation>

      {/* Input */}
      <div className="border-t bg-white dark:bg-gray-800 p-4">
        <form onSubmit={handleSubmit} className="max-w-3xl mx-auto flex gap-2">
          <Input
            value={input}
            onChange={handleInputChange}
            placeholder="Type your message..."
            disabled={isLoading}
            className="flex-1"
          />
          <button
            type="submit"
            disabled={isLoading || !input.trim()}
            className="px-4 py-2 bg-blue-500 text-white rounded disabled:opacity-50 disabled:cursor-not-allowed"
          >
            Send
          </button>
        </form>
      </div>
    </div>
  );
}
```

### 3.4 ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ãŒæ­£ã—ãä½œæˆã•ã‚Œã¦ã„ã‚‹
- [ ] API Route HandlerãŒå‹•ä½œã—ã¦ã„ã‚‹
- [ ] ãƒãƒ£ãƒƒãƒˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãŒå‹•ä½œã—ã¦ã„ã‚‹
- [ ] ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æ°¸ç¶šåŒ–ãŒå‹•ä½œã—ã¦ã„ã‚‹
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ãŒè¡¨ç¤ºã•ã‚Œã‚‹

---

## 4. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ2: AIæ”¯æ´ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç”Ÿæˆãƒ„ãƒ¼ãƒ«

### 4.1 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

AIæ”¯æ´ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç”Ÿæˆãƒ„ãƒ¼ãƒ«ã¯ã€ä»¥ä¸‹ã®æ©Ÿèƒ½ã‚’æŒã¤å®Ÿç”¨çš„ãªãƒ„ãƒ¼ãƒ«ã§ã™ï¼š

- ãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆæ©Ÿèƒ½
- æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ã®ç”Ÿæˆ
- Markdownå½¢å¼ã§ã®å‡ºåŠ›
- Streamdownã‚’ä½¿ç”¨ã—ãŸãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼

### 4.2 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
app/
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ generate/
â”‚   â”‚   â””â”€â”€ route.ts          # ãƒ†ã‚­ã‚¹ãƒˆç”ŸæˆAPI
â”‚   â””â”€â”€ generate-object/
â”‚       â””â”€â”€ route.ts          # æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ç”ŸæˆAPI
â”œâ”€â”€ docs/
â”‚   â””â”€â”€ page.tsx              # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç”Ÿæˆãƒšãƒ¼ã‚¸
â””â”€â”€ components/
    â”œâ”€â”€ DocumentEditor.tsx
    â”œâ”€â”€ DocumentPreview.tsx
    â””â”€â”€ TemplateSelector.tsx
```

### 4.3 å®Ÿè£…æ‰‹é †

#### ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ†ã‚­ã‚¹ãƒˆç”ŸæˆAPIã®ä½œæˆ

**`app/api/generate/route.ts`**ã‚’ä½œæˆï¼š

```typescript
import { streamText } from 'ai';
import { openai } from '@ai-sdk/openai';

export async function POST(req: Request) {
  try {
    const { prompt, template } = await req.json();

    const systemPrompt = template
      ? `You are a professional document writer. Generate a document following this template: ${template}`
      : 'You are a professional document writer. Generate a well-structured document.';

    const result = await streamText({
      model: openai('gpt-4'),
      system: systemPrompt,
      prompt,
      maxTokens: 2000,
    });

    return result.toUIMessageStreamResponse();  // AI SDK 6ã§ã¯useChat()ãŒã“ã®å½¢å¼ã‚’æœŸå¾…
  } catch (error) {
    console.error('Generate API error:', error);
    return Response.json(
      { error: 'Failed to generate document' },
      { status: 500 }
    );
  }
}
```

#### ã‚¹ãƒ†ãƒƒãƒ—2: æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ç”ŸæˆAPIã®ä½œæˆ

**`app/api/generate-object/route.ts`**ã‚’ä½œæˆï¼š

```typescript
import { generateObject } from 'ai';
import { openai } from '@ai-sdk/openai';
import { z } from 'zod';

const documentSchema = z.object({
  title: z.string(),
  sections: z.array(
    z.object({
      heading: z.string(),
      content: z.string(),
    })
  ),
  conclusion: z.string(),
});

export async function POST(req: Request) {
  try {
    const { prompt } = await req.json();

    const { object } = await generateObject({
      model: openai('gpt-4'),
      schema: documentSchema,
      prompt,
    });

    return Response.json({ document: object });
  } catch (error) {
    console.error('Generate object API error:', error);
    return Response.json(
      { error: 'Failed to generate structured document' },
      { status: 500 }
    );
  }
}
```

#### ã‚¹ãƒ†ãƒƒãƒ—3: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç”Ÿæˆãƒšãƒ¼ã‚¸ã®ä½œæˆ

**`app/docs/page.tsx`**ã‚’ä½œæˆï¼š

```typescript
'use client';

import { useState } from 'react';
import { Streamdown } from 'streamdown';
import { useChat } from '@ai-sdk/react';

const TEMPLATES = [
  { id: 'article', name: 'Article', prompt: 'Write an article about...' },
  { id: 'tutorial', name: 'Tutorial', prompt: 'Create a tutorial about...' },
  { id: 'api-docs', name: 'API Documentation', prompt: 'Write API documentation for...' },
];

export default function DocsPage() {
  const [selectedTemplate, setSelectedTemplate] = useState<string>('');
  const [prompt, setPrompt] = useState('');
  const { messages, input, handleInputChange, handleSubmit, isLoading } =
    useChat({
      api: '/api/generate',
      body: {
        template: selectedTemplate,
      },
    });

  const handleTemplateSelect = (templateId: string) => {
    setSelectedTemplate(templateId);
    const template = TEMPLATES.find((t) => t.id === templateId);
    if (template) {
      setPrompt(template.prompt);
    }
  };

  return (
    <div className="flex h-screen">
      {/* Sidebar */}
      <div className="w-64 border-r bg-gray-50 dark:bg-gray-900 p-4">
        <h2 className="font-semibold mb-4">Templates</h2>
        <div className="space-y-2">
          {TEMPLATES.map((template) => (
            <button
              key={template.id}
              onClick={() => handleTemplateSelect(template.id)}
              className={`w-full text-left p-2 rounded ${
                selectedTemplate === template.id
                  ? 'bg-blue-500 text-white'
                  : 'bg-white dark:bg-gray-800 hover:bg-gray-100'
              }`}
            >
              {template.name}
            </button>
          ))}
        </div>
      </div>

      {/* Main Content */}
      <div className="flex-1 flex flex-col">
        {/* Editor */}
        <div className="border-b p-4">
          <form onSubmit={handleSubmit} className="space-y-4">
            <textarea
              value={prompt}
              onChange={(e) => setPrompt(e.target.value)}
              placeholder="Enter your prompt..."
              className="w-full p-2 border rounded"
              rows={4}
            />
            <button
              type="submit"
              disabled={isLoading || !prompt.trim()}
              className="px-4 py-2 bg-blue-500 text-white rounded disabled:opacity-50"
            >
              {isLoading ? 'Generating...' : 'Generate Document'}
            </button>
          </form>
        </div>

        {/* Preview */}
        <div className="flex-1 overflow-y-auto p-4">
          {messages.length === 0 && (
            <div className="text-center text-gray-500 mt-8">
              <p>Select a template and enter a prompt to generate a document.</p>
            </div>
          )}
          {messages.map((message) => (
            <div key={message.id} className="prose max-w-none">
              <Streamdown isAnimating={isLoading}>
                {message.content}
              </Streamdown>
            </div>
          ))}
        </div>
      </div>
    </div>
  );
}
```

### 4.4 ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] ãƒ†ã‚­ã‚¹ãƒˆç”ŸæˆAPIãŒå‹•ä½œã—ã¦ã„ã‚‹
- [ ] æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ç”ŸæˆAPIãŒå‹•ä½œã—ã¦ã„ã‚‹
- [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç”Ÿæˆãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠãŒå‹•ä½œã—ã¦ã„ã‚‹
- [ ] ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] MarkdownãŒæ­£ã—ããƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã‚‹

---

## 5. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ3: ãƒãƒ«ãƒãƒ¢ãƒ¼ãƒ€ãƒ«AIã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³

### 5.1 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

ãƒãƒ«ãƒãƒ¢ãƒ¼ãƒ€ãƒ«AIã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€ä»¥ä¸‹ã®æ©Ÿèƒ½ã‚’æŒã¤é«˜åº¦ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ï¼š

- ãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆ
- ç”»åƒç”Ÿæˆ
- éŸ³å£°è»¢å†™
- çµ±åˆUIã®æ§‹ç¯‰

### 5.2 å®Ÿè£…æ‰‹é †

#### ã‚¹ãƒ†ãƒƒãƒ—1: ç”»åƒç”ŸæˆAPIã®ä½œæˆ

**`app/api/generate-image/route.ts`**ã‚’ä½œæˆï¼š

```typescript
import { generateImage } from 'ai';
import { openai } from '@ai-sdk/openai';

export async function POST(req: Request) {
  try {
    const { prompt } = await req.json();

    const { image } = await generateImage({
      model: openai('dall-e-3'),
      prompt,
    });

    return Response.json({ image });
  } catch (error) {
    console.error('Image generation error:', error);
    return Response.json(
      { error: 'Failed to generate image' },
      { status: 500 }
    );
  }
}
```

#### ã‚¹ãƒ†ãƒƒãƒ—2: éŸ³å£°è»¢å†™APIã®ä½œæˆ

**`app/api/transcribe/route.ts`**ã‚’ä½œæˆï¼š

```typescript
import { transcribe } from 'ai';
import { openai } from '@ai-sdk/openai';

export async function POST(req: Request) {
  try {
    const formData = await req.formData();
    const file = formData.get('file') as File;

    const { text } = await transcribe({
      model: openai('whisper-1'),
      file,
    });

    return Response.json({ text });
  } catch (error) {
    console.error('Transcription error:', error);
    return Response.json(
      { error: 'Failed to transcribe audio' },
      { status: 500 }
    );
  }
}
```

#### ã‚¹ãƒ†ãƒƒãƒ—3: çµ±åˆUIã®ä½œæˆ

**`app/multimodal/page.tsx`**ã‚’ä½œæˆï¼š

```typescript
'use client';

import { useState } from 'react';
import { useChat } from '@ai-sdk/react';
import { Streamdown } from 'streamdown';

export default function MultimodalPage() {
  const [mode, setMode] = useState<'text' | 'image' | 'audio'>('text');
  const { messages, input, handleInputChange, handleSubmit, isLoading } =
    useChat({
      api: '/api/chat',
    });

  const handleImageGenerate = async (prompt: string) => {
    const response = await fetch('/api/generate-image', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ prompt }),
    });
    const { image } = await response.json();
    // ç”»åƒã‚’è¡¨ç¤º
  };

  const handleAudioTranscribe = async (file: File) => {
    const formData = new FormData();
    formData.append('file', file);
    const response = await fetch('/api/transcribe', {
      method: 'POST',
      body: formData,
    });
    const { text } = await response.json();
    // è»¢å†™çµæœã‚’è¡¨ç¤º
  };

  return (
    <div className="flex flex-col h-screen">
      {/* Mode Selector */}
      <div className="border-b p-4 flex gap-2">
        <button
          onClick={() => setMode('text')}
          className={`px-4 py-2 rounded ${
            mode === 'text' ? 'bg-blue-500 text-white' : ''
          }`}
        >
          Text
        </button>
        <button
          onClick={() => setMode('image')}
          className={`px-4 py-2 rounded ${
            mode === 'image' ? 'bg-blue-500 text-white' : ''
          }`}
        >
          Image
        </button>
        <button
          onClick={() => setMode('audio')}
          className={`px-4 py-2 rounded ${
            mode === 'audio' ? 'bg-blue-500 text-white' : ''
          }`}
        >
          Audio
        </button>
      </div>

      {/* Content */}
      <div className="flex-1 overflow-y-auto p-4">
        {mode === 'text' && (
          <div>
            {messages.map((message) => (
              <div key={message.id}>
                <Streamdown isAnimating={isLoading}>
                  {message.content}
                </Streamdown>
              </div>
            ))}
          </div>
        )}
        {mode === 'image' && (
          <div>
            {/* ç”»åƒç”ŸæˆUI */}
          </div>
        )}
        {mode === 'audio' && (
          <div>
            {/* éŸ³å£°è»¢å†™UI */}
          </div>
        )}
      </div>

      {/* Input */}
      <div className="border-t p-4">
        <form onSubmit={handleSubmit}>
          <input
            value={input}
            onChange={handleInputChange}
            placeholder="Enter your input..."
            className="w-full p-2 border rounded"
            disabled={isLoading}
          />
        </form>
      </div>
    </div>
  );
}
```

### 5.3 ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] ãƒ†ã‚­ã‚¹ãƒˆç”ŸæˆãŒå‹•ä½œã—ã¦ã„ã‚‹
- [ ] ç”»åƒç”ŸæˆãŒå‹•ä½œã—ã¦ã„ã‚‹
- [ ] éŸ³å£°è»¢å†™ãŒå‹•ä½œã—ã¦ã„ã‚‹
- [ ] çµ±åˆUIãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆãŒå‹•ä½œã—ã¦ã„ã‚‹

---

## 6. ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### 6.1 ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

#### API Route Handlerã§ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

```typescript
import { convertToModelMessages, streamText, UIMessage } from 'ai';
import { openai } from '@ai-sdk/openai';

export async function POST(req: Request) {
  try {
    // ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®æ¤œè¨¼
    const { messages }: { messages: UIMessage[] } = await req.json();
    if (!messages || !Array.isArray(messages)) {
      return Response.json(
        { error: 'Invalid request format' },
        { status: 400 }
      );
    }

    // APIå‘¼ã³å‡ºã—
    const result = await streamText({
      model: openai('gpt-4'),
      messages: await convertToModelMessages(messages),  // AI SDK 6ã§ã¯UIMessageã‚’ModelMessageã«å¤‰æ›
    });

    return result.toUIMessageStreamResponse();  // AI SDK 6ã§ã¯useChat()ãŒã“ã®å½¢å¼ã‚’æœŸå¾…
  } catch (error) {
    // ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°
    console.error('API error:', error);

    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
    return Response.json(
      {
        error: 'An error occurred while processing your request',
        details: process.env.NODE_ENV === 'development' ? error.message : undefined,
      },
      { status: 500 }
    );
  }
}
```

#### ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

```typescript
const { messages, error, handleSubmit } = useChat({
  api: '/api/chat',
  onError: (error) => {
    console.error('Chat error:', error);
    // ã‚¨ãƒ©ãƒ¼ãƒãƒ†ã‚£ãƒ•ã‚£ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
    toast.error('Failed to send message. Please try again.');
  },
});
```

### 6.2 ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã®ç®¡ç†

```typescript
const { isLoading, messages } = useChat({
  api: '/api/chat',
});

// ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼
{isLoading && (
  <div className="flex items-center gap-2">
    <Spinner />
    <span>Generating response...</span>
  </div>
)}
```

### 6.3 ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®è€ƒæ…®

```typescript
// API Route Handlerã§ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚’å®Ÿè£…
import { Ratelimit } from '@upstash/ratelimit';
import { Redis } from '@upstash/redis';

const ratelimit = new Ratelimit({
  redis: Redis.fromEnv(),
  limiter: Ratelimit.slidingWindow(10, '10 s'),
});

export async function POST(req: Request) {
  const ip = req.headers.get('x-forwarded-for') || 'unknown';
  const { success } = await ratelimit.limit(ip);

  if (!success) {
    return Response.json(
      { error: 'Rate limit exceeded. Please try again later.' },
      { status: 429 }
    );
  }

  // ç¶šãã®å‡¦ç†...
}
```

### 6.4 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–

#### å…¥åŠ›ã®æ¤œè¨¼

```typescript
import { z } from 'zod';

const messageSchema = z.object({
  role: z.enum(['user', 'assistant', 'system']),
  content: z.string().max(10000), // æœ€å¤§æ–‡å­—æ•°åˆ¶é™
});

export async function POST(req: Request) {
  const body = await req.json();
  const validated = messageSchema.parse(body);
  // ...
}
```

#### APIã‚­ãƒ¼ã®ä¿è­·

```typescript
// .env.localã«ä¿å­˜ï¼ˆGitã«ã‚³ãƒŸãƒƒãƒˆã—ãªã„ï¼‰
OPENAI_API_KEY=your_key_here

// API Route Handlerã§ä½¿ç”¨
const apiKey = process.env.OPENAI_API_KEY;
if (!apiKey) {
  throw new Error('API key not configured');
}
```

### 6.5 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

#### ãƒ¡ãƒ¢åŒ–ã®ä½¿ç”¨

```typescript
import { memo } from 'react';

const MemoizedStreamdown = memo(Streamdown);

function MessageContent({ content, isAnimating }: { content: string; isAnimating: boolean }) {
  return (
    <MemoizedStreamdown isAnimating={isAnimating}>
      {content}
    </MemoizedStreamdown>
  );
}
```

#### ä»®æƒ³åŒ–ã®ä½¿ç”¨ï¼ˆå¤§é‡ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒã‚ã‚‹å ´åˆï¼‰

```typescript
import { useVirtualizer } from '@tanstack/react-virtual';

const virtualizer = useVirtualizer({
  count: messages.length,
  getScrollElement: () => parentRef.current,
  estimateSize: () => 100,
});
```

### 6.6 ãƒ†ã‚¹ãƒˆã®ä½œæˆ

#### ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã®ä¾‹

```typescript
// __tests__/api/chat.test.ts
import { POST } from '@/app/api/chat/route';

describe('Chat API', () => {
  it('should return a streaming response', async () => {
    const request = new Request('http://localhost/api/chat', {
      method: 'POST',
      body: JSON.stringify({
        messages: [{ role: 'user', content: 'Hello' }],
      }),
    });

    const response = await POST(request);
    expect(response.status).toBe(200);
  });
});
```

---

## 7. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ã¨ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### 7.1 æ¨å¥¨ã•ã‚Œã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
learn-vercel-ai/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/                    # API Route Handlers
â”‚   â”œâ”€â”€ (routes)/               # ãƒšãƒ¼ã‚¸ãƒ«ãƒ¼ãƒˆ
â”‚   â”œâ”€â”€ layout.tsx
â”‚   â””â”€â”€ page.tsx
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ai-elements/            # AI Elementsã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”œâ”€â”€ ui/                     # shadcn/uiã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â””â”€â”€ custom/                 # ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ db.ts                   # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶š
â”‚   â”œâ”€â”€ utils.ts                # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
â”‚   â””â”€â”€ ai.ts                   # AIé–¢é€£ã®ãƒ˜ãƒ«ãƒ‘ãƒ¼
â”œâ”€â”€ types/
â”‚   â””â”€â”€ index.ts                # TypeScriptå‹å®šç¾©
â”œâ”€â”€ .env.local                  # ç’°å¢ƒå¤‰æ•°ï¼ˆGitã«ã‚³ãƒŸãƒƒãƒˆã—ãªã„ï¼‰
â””â”€â”€ package.json
```

### 7.2 ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³

#### ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
Presentation Layer (UI Components)
    â†“
Business Logic Layer (API Routes)
    â†“
Data Access Layer (Database/External APIs)
```

#### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®åˆ†é›¢

- **Presentational Components**: UIã®ã¿ã‚’æ‹…å½“
- **Container Components**: ãƒ‡ãƒ¼ã‚¿å–å¾—ã¨ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ‹…å½“
- **Shared Components**: å†åˆ©ç”¨å¯èƒ½ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

---

## 8. å®Ÿè·µã‚¿ã‚¹ã‚¯

### ã‚¿ã‚¹ã‚¯1: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ1ã®å®Ÿè£…

**ç›®æ¨™**: é«˜åº¦ãªãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã‚’å®Œå…¨ã«å®Ÿè£…ã™ã‚‹

**æ‰‹é †**:
1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ã‚’ä½œæˆ
2. API Route Handlerã‚’å®Ÿè£…
3. ãƒãƒ£ãƒƒãƒˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®Ÿè£…
4. ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—ã‚’å®Ÿè£…
5. ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æ°¸ç¶šåŒ–ã‚’å®Ÿè£…
6. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’å®Ÿè£…

**ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ**:
- [ ] ã™ã¹ã¦ã®æ©Ÿèƒ½ãŒå‹•ä½œã—ã¦ã„ã‚‹
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒæœ€é©åŒ–ã•ã‚Œã¦ã„ã‚‹
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹

### ã‚¿ã‚¹ã‚¯2: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ2ã®å®Ÿè£…

**ç›®æ¨™**: AIæ”¯æ´ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç”Ÿæˆãƒ„ãƒ¼ãƒ«ã‚’å®Ÿè£…ã™ã‚‹

**æ‰‹é †**:
1. ãƒ†ã‚­ã‚¹ãƒˆç”ŸæˆAPIã‚’å®Ÿè£…
2. æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ç”ŸæˆAPIã‚’å®Ÿè£…
3. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç”Ÿæˆãƒšãƒ¼ã‚¸ã‚’å®Ÿè£…
4. ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ©Ÿèƒ½ã‚’å®Ÿè£…
5. ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’å®Ÿè£…

**ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ**:
- [ ] ã™ã¹ã¦ã®æ©Ÿèƒ½ãŒå‹•ä½œã—ã¦ã„ã‚‹
- [ ] ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒæ­£ã—ãå‹•ä½œã—ã¦ã„ã‚‹
- [ ] ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹

### ã‚¿ã‚¹ã‚¯3: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ3ã®å®Ÿè£…

**ç›®æ¨™**: ãƒãƒ«ãƒãƒ¢ãƒ¼ãƒ€ãƒ«AIã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…ã™ã‚‹

**æ‰‹é †**:
1. ç”»åƒç”ŸæˆAPIã‚’å®Ÿè£…
2. éŸ³å£°è»¢å†™APIã‚’å®Ÿè£…
3. çµ±åˆUIã‚’å®Ÿè£…
4. ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆã‚’å®Ÿè£…

**ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ**:
- [ ] ã™ã¹ã¦ã®ãƒ¢ãƒ¼ãƒ‰ãŒå‹•ä½œã—ã¦ã„ã‚‹
- [ ] çµ±åˆUIãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆãŒã‚¹ãƒ ãƒ¼ã‚ºã«å‹•ä½œã™ã‚‹

### ã‚¿ã‚¹ã‚¯4: ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã®é©ç”¨

**ç›®æ¨™**: ã™ã¹ã¦ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã‚’é©ç”¨ã™ã‚‹

**æ‰‹é †**:
1. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’æ”¹å–„
2. ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã‚’æ”¹å–„
3. ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚’å®Ÿè£…
4. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ã‚’å¼·åŒ–
5. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’æœ€é©åŒ–
6. ãƒ†ã‚¹ãƒˆã‚’ä½œæˆ

**ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ**:
- [ ] ã™ã¹ã¦ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ãŒé©ç”¨ã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒ†ã‚¹ãƒˆãŒä½œæˆã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒæ•´å‚™ã•ã‚Œã¦ã„ã‚‹

---

## 9. ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### 9.1 ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼ã¨è§£æ±ºæ–¹æ³•

#### ã‚¨ãƒ©ãƒ¼: "API key not found"
**è§£æ±ºæ–¹æ³•**: `.env.local`ãƒ•ã‚¡ã‚¤ãƒ«ã«APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

#### ã‚¨ãƒ©ãƒ¼: "Rate limit exceeded"
**è§£æ±ºæ–¹æ³•**: ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚’å®Ÿè£…ã—ã€é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º

#### ã‚¨ãƒ©ãƒ¼: "Streaming not working"
**è§£æ±ºæ–¹æ³•**: API Route Handlerã§`toUIMessageStreamResponse()`ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã‹ç¢ºèªï¼ˆAI SDK 6ã§ã¯`useChat()`ãŒã“ã®å½¢å¼ã‚’æœŸå¾…ï¼‰

### 9.2 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®å•é¡Œ

#### å¤§é‡ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§é…ã„
**è§£æ±ºæ–¹æ³•**: ãƒ¡ãƒ¢åŒ–ã‚„ä»®æƒ³åŒ–ã‚’ä½¿ç”¨

#### ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãŒé…ã„
**è§£æ±ºæ–¹æ³•**: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã‚’ç¢ºèªã—ã€å¿…è¦ã«å¿œã˜ã¦æœ€é©åŒ–

### 9.3 ãƒ‡ãƒãƒƒã‚°ã®ãƒ’ãƒ³ãƒˆ

#### ãƒ­ã‚°ã®è¿½åŠ 

```typescript
console.log('Request:', { messages, conversationId });
console.log('Response:', response);
```

#### ãƒ–ãƒ©ã‚¦ã‚¶ã®é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨

- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¿ãƒ–ã§APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ç¢ºèª
- ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã‚¨ãƒ©ãƒ¼ã‚’ç¢ºèª
- React DevToolsã§ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çŠ¶æ…‹ã‚’ç¢ºèª

---

## 10. æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

ãƒ•ã‚§ãƒ¼ã‚º4ã‚’å®Œäº†ã—ãŸã‚‰ã€ä»¥ä¸‹ã®ã‚¹ãƒ†ãƒƒãƒ—ã«é€²ã¿ã¾ã—ã‚‡ã†ï¼š

1. **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ‹¡å¼µ**
   - æ–°ã—ã„æ©Ÿèƒ½ã®è¿½åŠ 
   - æ—¢å­˜æ©Ÿèƒ½ã®æ”¹å–„

2. **ãƒ‡ãƒ—ãƒ­ã‚¤**
   - Vercelã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤
   - æœ¬ç•ªç’°å¢ƒã§ã®å‹•ä½œç¢ºèª

3. **ç¶™ç¶šçš„ãªå­¦ç¿’**
   - æ–°ã—ã„AIæ©Ÿèƒ½ã®æ¢ç´¢
   - ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã¸ã®å‚åŠ 

---

## ğŸ“š å‚è€ƒãƒªã‚½ãƒ¼ã‚¹

### å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- [AI SDK Documentation](https://ai-sdk.dev/docs)
- [AI Elements Documentation](https://ai-sdk.dev/elements)
- [Streamdown Documentation](https://streamdown.ai/docs)

### ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹
- [Next.js Best Practices](https://nextjs.org/docs)
- [React Best Practices](https://react.dev/learn)
- [TypeScript Best Practices](https://www.typescriptlang.org/docs/)

### ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£
- [GitHub Discussions](https://github.com/vercel/ai/discussions)
- [Vercel Community](https://vercel.com/community)

---

## âœ… ãƒ•ã‚§ãƒ¼ã‚º4å®Œäº†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå®Ÿè£…
- [ ] ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ1ã‚’å®Ÿè£…ã—ãŸ
- [ ] ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ2ã‚’å®Ÿè£…ã—ãŸ
- [ ] ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ3ã‚’å®Ÿè£…ã—ãŸ

### ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’å®Ÿè£…ã—ãŸ
- [ ] ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã‚’ç®¡ç†ã—ã¦ã„ã‚‹
- [ ] ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚’è€ƒæ…®ã—ã¦ã„ã‚‹
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ã‚’å®Ÿè£…ã—ãŸ
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’æœ€é©åŒ–ã—ãŸ
- [ ] ãƒ†ã‚¹ãƒˆã‚’ä½œæˆã—ãŸ

### ã‚¹ã‚­ãƒ«
- [ ] AI SDK Coreã‚’æ´»ç”¨ã§ãã‚‹
- [ ] AI Elementsã‚’ä½¿ç”¨ã§ãã‚‹
- [ ] Streamdownã‚’å®Ÿè£…ã§ãã‚‹
- [ ] çµ±åˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’æ§‹ç¯‰ã§ãã‚‹

---

**ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼ãƒ•ã‚§ãƒ¼ã‚º4ã‚’å®Œäº†ã—ã¾ã—ãŸï¼ğŸ‰**

ã“ã‚Œã§ã€Vercel AI SDKã‚’ä½¿ã£ãŸå®Ÿç”¨çš„ãªAIã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ§‹ç¯‰ã™ã‚‹ãŸã‚ã®çŸ¥è­˜ã¨ã‚¹ã‚­ãƒ«ã‚’èº«ã«ã¤ã‘ã¾ã—ãŸã€‚

---

**å­¦ç¿’ãƒ­ã‚°**:
- é–‹å§‹æ—¥: ___________
- å®Œäº†æ—¥: ___________
- ãƒ¡ãƒ¢: 

